name: Main branch flow for Inventory checker
run-name: ${{ github.actor }} main branch push
on:
    workflow_dispatch:
    push:
        branches: [main]
    pull_request:
        branches: [main]
jobs:
    snyk-scan:
        runs-on: ubuntu-latest
        steps:
            -
                name: Check out repository code
                uses: actions/checkout@v3
            -
                name: Installing python
                uses: actions/setup-python@v4
                with:
                    python-version: '3.10'
                    cache: 'pip'
            - uses: snyk/actions/setup@master
            - run: |
                    cd app
                    python3 -m venv venv
                    source venv/bin/activate
                    pip install -r requirements.txt
                    snyk test --sarif-file-output=snyk.sarif
                    cat snyk.sarif
              env:
                    SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
            -
                name: Upload result to GitHub Code Scanning
                uses: github/codeql-action/upload-sarif@v2
                with:
                    sarif_file: app/snyk.sarif
            -
                name: Snyk code analysis
                run: |
                      cd app
                      snyk code test --sarif-file-output=snyk-code.sarif
                      cat snyk-code.sarif